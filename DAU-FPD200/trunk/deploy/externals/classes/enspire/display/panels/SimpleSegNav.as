import enspire.core.Serverimport enspire.ile.AppEvents;import enspire.display.layout.ToggleClipSlider;import enspire.model.State;import com.mosesSupposes.fuse.*;class enspire.display.panels.SimpleSegNav extends MovieClip{	private var aClips:Array;	private var aSegs:Array;	public static var MENU_PADDING = 0;	function SimpleSegNav() {		this.aClips = new Array();		Server.connect(this, "update", AppEvents.START_SEG);	}	public function initNav() {				var nClipY = 0;		var aClips = Server.model.structure.aClips;		// loop through clips		for(var i:Number = 0; i < aClips.length; i++) {			var mcClipTitle = this.attachMovie("Nav_Clip", "mcClipTitleTitle"+i, i);			////trace("NavItem Added");			mcClipTitle._y = nClipY;			nClipY += MENU_PADDING;			nClipY += mcClipTitle._height;			mcClipTitle.aSegs = new Array();			mcClipTitle.controller = this;			mcClipTitle.nAnchorPoint = nSegY;						mcClipTitle.mcText.tf.htmlText = aClips[i].title;			mcClipTitle.mcText.tf.autoSize = true;			mcClipTitle.bSelected = false;			mcClipTitle.mcSelected._visible = false;			mcClipTitle.bCurrent = false;			mcClipTitle.nSegIndex = aClips[i].getStartSegIndex();			mcClipTitle.bVisited = false;			mcClipTitle.mcComplete._visible = false;						mcClipTitle.onRelease = function() {				//Server.getController("app").gotoIndex(this.nSegIndex);				this.controller.openMenu(this);				this.bSelected = true;				this.mcSelected._visible = true;				this.gotoAndStop("overNoOut");			}			mcClipTitle.onRollOver = function() {				this.gotoAndStop("over")					}			mcClipTitle.onRollOut = mcClipTitle.onReleaseOutside = function() {				this.gotoAndStop("out");			}						mcClipTitle.onPress = function () {				this.gotoAndStop("down");			}			this.aClips.push(mcClipTitle);			var aSegments = aClips[i].aSegment;						//===			// start y the bottom of main menu item				var nSegY = mcClipTitle._height;				var aSegments = aClips[i].aSegment;								for (var j=0; j<aSegments.length; j++){					// if we have a title we should have a link					if(aSegments[j].args.sTitle != undefined) {												var mcSegTitle:MovieClip =  mcClipTitle.attachMovie("Nav_Seg", "mcSeg_" + j, this._parent.getNextHighestDepth());						mcSegTitle.mcText.tf.text = aSegments[j].args.sTitle;						mcSegTitle.mcText.tf.autoSize = true;						mcSegTitle.bSelected = false;						mcSegTitle.mcSelected._visible = false;												mcSegTitle.bCurrent = false;						mcSegTitle.bVisited = false;												mcSegTitle.mcComplete._visible = false;						mcSegTitle.nSecIndex = 0;						mcSegTitle.nClipIndex = i;						mcSegTitle.nSegIndex = j;						mcSegTitle._y = nSegY;						mcSegTitle._visible = false;						mcSegTitle.mcBg._height = mcSegTitle.mcText._height + (mcSegTitle.mcText._y * 2);												// initialize seg handlers						mcSegTitle.onRelease = function() {							this.bSelected = true;							this.mcSelected._visible = true;							Server.getController("app").gotoIndex(this.nSegIndex);						}						mcSegTitle.onRollOver = function() {							this.gotoAndPlay("over")						}						mcSegTitle.onRollOut = mcSegTitle.onReleaseOutside = function() {							this.gotoAndPlay("out");						}						mcSegTitle.onPress = function() {							this.gotoAndStop("down");						}						nSegY += mcSegTitle._height;						mcClipTitle.aSegs.push(mcSegTitle);					}else{						mcClipTitle.aSegs.push(false)					}									}								//===					}			}	public function update(secId:Number, clipId:Number, segId:Number) {		var secId = State.nSection;		var clipId = State.nClip;		var segId = State.nSegment;				//trace("UPDATE MENU  "+clipId+" LOOPING THROUGH "+aClips.length);		for(var i = 0; i < aClips.length; i++) {			//trace("Clip I >> " + i + " | clipId " + clipId);			if(i == clipId) {				////trace("SELECT: "+aClips[i]);				aClips[i].bSelected = true;				aClips[i].mcSelected._visible = true;			}else {				////trace("DESELECT: "+aClips[i]);				aClips[i].gotoAndStop("up");				aClips[i].bSelected = false;				aClips[i].mcSelected._visible = false;			}		}	}	private function openMenu(mcRef) {		var nY = 0;		var nTotalSegHeight = 0;		for(var j = 0; j < mcRef.aSegs.length; j++) {			var mcSegItem = mcRef.aSegs[j];			if(mcSegItem != false) {				mcSegItem._visible = true;				nTotalSegHeight += mcSegItem._height;				//trace("OPENING NAV >> " + mcRef + " | SEG >> " + mcRef.aSegs + " | HEIGHT >> " + mcRef.aSegs[j]._height);			}		}				for(var i=0; i < aClips.length; i++) {			var mcClip = aClips[i];			//trace("OPENING NAV >>> " + mcRef.nClipIndex + " | i " + i);			if(mcRef.nClipIndex < i) {								mcClip._y = nY				nY += nTotalSegHeight;			}		}								mcRef.bOpen = true;	}	public function toString() {		return "enspire.display.panels.CourseNav";	}}